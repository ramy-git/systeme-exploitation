#include <err.h>
#include <stdlib.h>
#include <unistd.h>

#include "carrefour.h"

static int parse_int(char *s)
{
    char *err = NULL;
    int value = strtol(s, &err, 10);

    if (err[0] != '\0')
        errx(1, "invalid integer `%s`", s);

    return value;
}

struct options parse_opts(int argc, char **args)
{
    struct options result;

    result.automatic = 0;
    result.time = 1000;
    result.max_car = 0;

    int opt;

    while ((opt = getopt(argc, args, ":t:n:a:")) != -1)
    {
        switch (opt)
        {
            case 'a':
                result.automatic = parse_int(optarg);
                break;
            case 't':
                result.time = parse_int(optarg);
                break;
            case 'n':
                result.max_car = parse_int(optarg);
                break;
            case '?':
                errx(1, "unknown option `%c`", optopt);
                break;
        }
    }

    return result;
}
